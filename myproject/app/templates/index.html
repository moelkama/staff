<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
</head>
<body>
    <div id="container" class="flex flex-col items-center justify-center h-screen">
        <div id="search-container" class="mb-40 h-10 w-[660px] flex flex-col gap-8">
            <div class="flex items-center justify-between">
                <input id="search-input" class="font-bold w-4/5 border px-4 border-gray-300 rounded-xl" type="text" placeholder="Search Order">
                <button id="search-button" class="font-bold rounded-xl h-10 flex px-4 justify-center items-center bg-green-400 hover:border hover:border-slate-800 hover:bg-transparent">Search</button>
                <!-- <a target="_blank" href="/" id="search-a" class="font-bold rounded-xl h-10 flex px-4 justify-center items-center bg-green-400 hover:border hover:border-slate-800 hover:bg-transparent">Search</a> -->
            </div>
            <div id="search-result" class="w-full">
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <a class="font-bold rounded-xl h-10 flex px-4 justify-center items-center bg-green-400 hover:border hover:border-slate-800 hover:bg-transparent" href="/dynamic_form">Create Order</a>
            <a class="font-bold rounded-xl h-10 flex px-4 justify-center items-center bg-green-400 hover:border hover:border-slate-800 hover:bg-transparent" href="/find_order">find Order</a>
        </div>
    </div>
    <script>
        document.getElementById('search-button').addEventListener('click', () => {
            const order_id = document.getElementById('search-input').value;
            // document.getElementById('search-a').href = `/generate_pdf?id=${order_id}`;
            fetch(`/search_order/${order_id}`)
            .then(response => 
            {
                if (!response.ok)
                {
                    if (response.status === 404)
                    {
                        return response.json().then(data => {
                        document.getElementById('search-result').innerHTML = `<div class="text-2xl font-black text-center text-red-500">Order Not Found</div>`;
                        });
                    }
                    else
                        throw new Error('Something went wrong');
                }
                return response.json(); // If response is OK, process the response
            })
            .then((order) => {
                console.log("kayn::::::", order);
                const date = new Date(order.date);

                const day = String(date.getUTCDate()).padStart(2, '0'); // Day (2 digits)
                const month = String(date.getUTCMonth() + 1).padStart(2, '0'); // Month (2 digits, UTC)
                const year = date.getUTCFullYear(); // Year

                const hours = String(date.getUTCHours()).padStart(2, '0'); // Hours (24h UTC)
                const minutes = String(date.getUTCMinutes()).padStart(2, '0'); // Minutes
                const seconds = String(date.getUTCSeconds()).padStart(2, '0'); // Seconds

                const date_string = `${day}/${month}/${year} ${hours}:${minutes}`; //:${seconds}
                document.getElementById('search-result').innerHTML = `
                        <table class="w-full table-auto border-collapse border border-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-center">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-center">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-center">Total</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white">
                                <tr class="border-t border-gray-200">
                                    <!-- Order data -->
                                    <td class="text-center px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${order.id}</td>
                                    <td class="text-center px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date_string}</td>
                                    <td class="text-center px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.total}</td>
                                    
                                    <td class="flex justify-evenly items-center px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                        <a class="text-center font-black w-28 inline-block px-4 py-2 text-black bg-blue-400 hover:bg-gray-600 rounded-md focus:outline-none border hover:border-slate-800 hover:bg-transparent", href="">imprim</a>
                                        <a href="/generate_pdf/{{order.id}}" class="text-center font-black w-28 inline-block px-4 py-2 text-black bg-green-400 hover:bg-blue-600 rounded-md focus:outline-none border hover:border-slate-800 hover:bg-transparent" , target='_blank')">View</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                `;
            })
            .catch(error => {
                console.error("errrrrrrrrrrrrrrrrrrrroooooooooor")
                // console.error(error)
            });
        });
    </script>
</body>
</html>